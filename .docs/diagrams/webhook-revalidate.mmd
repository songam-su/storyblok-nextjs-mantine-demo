sequenceDiagram
  participant SB as Storyblok
  participant API as /api/webhooks/revalidate
  participant Guard as Verify secret + HMAC + timestamp
  participant Collect as Collect slugs
  participant Cache as revalidatePath(slug)

  SB->>API: POST body + signature + timestamp + secret query
  API->>Guard: validate secret + HMAC(rawBody) + timestamp freshness
  Guard-->>API: ok / 401 error
  alt valid
    API->>Collect: story.full_slug + alternates + cached_urls
    Collect-->>API: slugs array
    loop for each slug
      API->>Cache: revalidatePath(slug)
    end
    API-->>SB: 200 { revalidated: true, slugs }
  else invalid
    API-->>SB: 401 { error: "Invalid signature" | "Stale webhook" }
  end
