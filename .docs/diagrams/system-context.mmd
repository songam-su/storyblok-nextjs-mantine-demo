flowchart LR
  U[End User\nBrowser]
  CDN[CDN / Edge\nISR cache]
  NX[Next.js App\nApp Router]
  SB[Storyblok CDN/API]
  VE[Storyblok Visual Editor\nPreview iframe]
  PR[Preview route\n/api/preview + cookie]
  EP[/api/exit-preview/\nclear preview]
  WH[/api/webhooks/revalidate\nHMAC + timestamp/]
  RV[revalidatePath\n(invalidate slugs)]
  CFG[site-config story\nheader/footer/theme]

  U --> CDN
  CDN -- hit --> U
  CDN -- miss --> NX
  NX --> SB
  SB --> NX
  NX --> CDN
  NX --> U

  VE --> PR
  PR --> SB
  SB --> PR
  VE -. Bridge events .-> PR
  PR -. exit .-> EP

  SB -. publish/update webhook .-> WH
  WH -. triggers .-> RV

  SB -. fetch .-> CFG
  CFG -. theming/header/footer .-> NX
